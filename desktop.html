<!DOCTYPE html>
<html>
<head>
	<title>CIS 89A: BOT.NET Theme</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<link rel="stylesheet" type="text/css" href="fonts/roboto-mono-v5-latin/roboto-mono.css">
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<link rel="stylesheet" type="text/css" href="css/desktop.css">
	<link rel="stylesheet" type="text/css" href="css/terminal.css">
	<script src="api.js"></script>
</head>
<body>
	<div class="desktop">
		<div class="status-bar"></div>
		<div class="windows">
			<div class="windows-row">
				<div class="app">
					<div class="app-terminal">
					<!-- <stdout>
			      	<entry>Last login: Sat Jul 22 19:52:49 on ttys000</entry>
			        <error>That command does not exist.</error>
			      </stdout>
			      <prompt class="active"><pwd></pwd><stdin><cursor>&nbsp;</cursor><stdin></prompt> -->
					</div>
				</div>
				<!-- <div class="app"><div class="app-browser">1,0</div></div> -->
				<!-- <div class="app"><div class="app-browser">2,0</div></div> -->
			</div>
			<div class="windows-row">
				<div class="app"><div class="app-browser">0,1</div></div>
				<!-- <div class="app"><div class="app-browser">1,1</div></div> -->
				<!-- <div class="app"><div class="app-browser">2,1</div></div> -->
			</div>
			<!-- <div class="windows-row">
				<div class="app"><div class="app-browser">0,2</div></div>
				<div class="app"><div class="app-browser">1,2</div></div>
				<div class="app"><div class="app-browser">2,2</div></div>
			</div> -->
		</div>
	</div>
</body>
<script type="text/javascript">
function createElement(type, attrs)
{
	var elm = document.createElement(type);
	for (var attr in attrs) {
		elm[attr] = attrs[attr]
	}
	return (elm);
}

class Terminal {
	constructor(selector){
		this.env = {
			pwd : ''
		};

		this.e = {
			parent	: document.querySelector(selector),
			stdout	: document.createElement('div'),
    		prompt	: document.createElement('div'),
    		pwd		: document.createElement('span'),
    		input	: document.createElement('input'),
		};

		this.e.stdout.className = "stdout";
		this.e.prompt.className = "prompt active";
		this.e.pwd.className 	= "pwd";
		this.e.input.type		= "text";
		this.e.parent.appendChild(this.e.stdout);
		this.e.parent.appendChild(this.e.prompt);
		this.e.prompt.appendChild(this.e.pwd);
		this.e.prompt.appendChild(this.e.input);

		this.e.parent.onclick = () => {
			this.e.input.focus()
		}

		this.e.input.onkeydown = (e) => {
			if (e.keyCode == 13)
				this.submit();
		}

		this.send('entry', "Logged in on "+(new Date()).toGMTString())
	}
	// This sends an api request submitting whatever is in the prompt 
	submit(){
		var prompt = this.e.prompt.cloneNode(true)
		prompt.replaceChild(createElement('span', {innerText:prompt.lastChild.value}), prompt.lastChild)
		prompt.className = 'prompt';
		this.e.stdout.appendChild(prompt);
		var cmd = this.e.input.value;
		this.e.input.value = '';
		this.e.input.setAttribute('disabled', '')
		// API Call
		prompt.classList.add('error') // On receiving the API response set the status    
		this.e.input.removeAttribute('disabled') // Add to the end of the API call

		

	}
	// This is used to send messages to the terminal screen
	send(location, html, argv){
		var body = document.createElement('div');
		if (location == 'entry'){
			body.className = 'entry';
			body.innerHTML = html;
			this.e.stdout.appendChild(body);
			return (body);
		} else {
			console.error('location invalid')
		}
	}
}
terminal = new Terminal('.app-terminal')
</script>
<!-- <script type="text/javascript">
	document.querySelectorAll(".windows-row .app ").forEach((e)=>{e.onclick = ()=> {
		e.style.display = 'none'
		if (!Array.from(e.parentElement.children).filter((c)=>c.style.display != 'none').length){
			e.parentElement.style.display = 'none';
		}
	}})
</script> -->
<!-- <script src="canvas.js" type="text/javascript"></script> -->
</script>
</html>